var A=(w,a)=>()=>(a||w((a={exports:{}}).exports,a),a.exports);var j=A((Xt,rt)=>{rt.exports=Object.freeze({SPOTIFY_BASE_URL:"https://api.spotify.com/v1",REPO_ISSUES_URL:"https://github.com/Vap0r1ze/vpc-spotimbed/issues",SwatchOption:{None:"None",Vibrant:"Vibrant",DarkVibrant:"DarkVibrant",LightVibrant:"LightVibrant",DarkMuted:"DarkMuted",LightMuted:"LightMuted"}})});var st=A((Kt,nt)=>{var{get:H}=require("powercord/http"),{getModule:kt,http:St,spotify:xt,constants:{Endpoints:Ct}}=require("powercord/webpack"),{SPOTIFY_BASE_URL:it}=j(),R=!1;nt.exports={accessToken:null,accessTokenPromise:null,resourcePromises:{},getAccessToken(){return this.accessTokenPromise?this.accessTokenPromise:(this.accessTokenPromise=(async()=>{if(!R){let c=(await kt(["getActiveSocketAndDevice"])).getActiveSocketAndDevice();if(c?.socket?.accessToken)return R=!0,this.accessTokenPromise=null,c.socket.accessToken}R=!1;let w=await St.get(Ct.CONNECTIONS).then(a=>a.body.find(c=>c.type==="spotify").id);return xt.getAccessToken(w).then(a=>(this.accessTokenPromise=null,a.body.access_token)).catch(a=>(console.error(a),new Promise(()=>{})))})(),this.accessTokenPromise)},genericRequest(w){return w.set("Authorization",`Bearer ${this.accessToken}`),w.catch(async a=>{if(a){if(a.statusCode===401)return this.accessToken=await this.getAccessToken(),delete w._res,this.genericRequest(w);throw console.error(a.body,w.opts),a}})},getResource(w){if(this.resourcePromises[w])return this.resourcePromises[w];let a=this.genericRequest(H(`${it}${w}`)).then(c=>(delete this.resourcePromises[w],c.body));return this.resourcePromises[w]=a,a},getTrack(w){return this.getResource(`/tracks/${w}`)},getAlbum(w){return this.getResource(`/albums/${w}`)},getPlaylist(w){return this.getResource(`/playlists/${w}`)},getArtist(w){return this.getResource(`/artists/${w}`)},getArtistTopTracks(w,a){return this.getResource(`/artists/${w}/top-tracks?market=${a}`)},search(w,a="track",c=20){return this.genericRequest(H(`${it}/search`).query("q",w).query("type",a).query("limit",c)).then(u=>u.body)},async _fetchAll(w,a,c){let u=[];for(;w;){let r=H(w);a&&(r.query("limit",a),a=0),c&&(r.query("offset",c),c=0);let k=await this.genericRequest(r).then(g=>g.body);u.push(...k.items),w=k.next}return u}}});var at=A((ee,ot)=>{var{React:U}=require("powercord/webpack"),{SelectInput:Mt}=require("powercord/components/settings"),{SwatchOption:O}=j();ot.exports=class extends U.PureComponent{state={lastEdited:Date.now()};render(){let{getSetting:a,updateSetting:c,refreshEmbeds:u}=this.props;return U.createElement(U.Fragment,null,U.createElement(Mt,{onChange:({value:r})=>{c("swatch",r),this.setState({lastEdited:Date.now()}),u()},options:[{label:"None",value:O.None},{label:"Vibrant",value:O.Vibrant},{label:"Dark Vibrant",value:O.DarkVibrant},{label:"Light Vibrant",value:O.LightVibrant},{label:"Dark Muted",value:O.DarkMuted},{label:"Light Muted",value:O.LightMuted}],value:a("swatch",O.DarkVibrant),searchable:!0,required:!0},"Palette"))}}});var ct=A((re,ut)=>{ut.exports=class F{constructor(a){let c=[0,0,0,0];try{if(a instanceof Array)c=c.map((u,r)=>a[r]==null?u:a[r]);else if(a[0]==="#"){let u=a.slice(1);u.length<6&&(u=u.split("").map(r=>r+r).join("")),c[0]=parseInt(u.slice(0,2),16),c[1]=parseInt(u.slice(2,4),16),c[2]=parseInt(u.slice(4,6),16),u.length<8?c[3]=1:c[3]=parseInt(u.slice(6,8),16)/255}else if(a.startsWith("rgb")){let u=a.replace(/rgba?/,"").slice(1,-1).split(/, */);c[0]=parseInt(u[0]),c[1]=parseInt(u[1]),c[2]=parseInt(u[2]),u[3]?c[3]=parseFloat(u[3]):c[3]=1}}catch{c=[0,0,0,0]}this._rgba=c}get r(){return this._rgba[0]}get g(){return this._rgba[1]}get b(){return this._rgba[2]}get a(){return this._rgba[3]}get rgba(){return this._rgba.slice()}get rgb(){return this._rgba.slice(0,3)}get hex(){if(this._hex)return this._hex;let a=[this.r,this.g,this.b,Math.floor(this.a*255)];return this._hex=`#${a.map(c=>c.toString(16).padStart(2,"0")).join("").replace(/ff$/,"")}`,this._hex}get yiq(){if(this._yiq)return this._yiq;let a=this.rgb;return this._yiq=(a[0]*299+a[1]*587+a[2]*114)/1e3,this._yiq}get titleTextColor(){return this._titleTextColor?this._titleTextColor:(this._titleTextColor=this.yiq<200?"#fff":"#000",this._titleTextColor)}get bodyTextColor(){return this._bodyTextColor?this._bodyTextColor:(this._bodyTextColor=this.yiq<150?"#fff":"#000",this._bodyTextColor)}mix(a){if(a instanceof F||(a=new F(a)),this.a===0)return a;if(a.a===0)return this;if(a.a===1)return a;let c=1-(1-a.a)*(1-this.a),u=[Math.floor(a.r*a.a/c+this.r*this.a*(1-a.a)/c),Math.floor(a.g*a.a/c+this.g*this.a*(1-a.a)/c),Math.floor(a.b*a.a/c+this.b*this.a*(1-a.a)/c)];return new F([...u,c])}}});var ht=A((ne,lt)=>{var{React:Dt}=require("powercord/webpack"),G=ct();lt.exports=w=>class extends w{constructor(c){super(c),this.contrastRefs={}}_vpcCAGetBackground(c){let u=c,r=new G;do if(r=new G(getComputedStyle(u).backgroundColor).mix(r),r.a===1)break;while(u=u.parentElement);return r.a!==1&&(r=new G("#fff").mix(r)),r}_vpcCACheckContrast(){for(let c of Object.values(this.contrastRefs)){if(!c.current||!document.contains(c.current))continue;let u=c.current,r=this._vpcCAGetBackground(u);u.attributeStyleMap.set("--vpc-ca-title",r.titleTextColor),u.attributeStyleMap.set("--vpc-ca-body",r.bodyTextColor),u.attributeStyleMap.set("--vpc-ca-bg",r.hex)}}contrastRef(c){return this.contrastRefs[c]?this.contrastRefs[c]:this.contrastRefs[c]=Dt.createRef()}render(){let c=super.render();return setImmediate(()=>this._vpcCACheckContrast()),c}}});var pt=A((z,W)=>{(function(w,a){typeof z=="object"&&typeof W=="object"?W.exports=a():typeof define=="function"&&define.amd?define([],a):typeof z=="object"?z.Vibrant=a():w.Vibrant=a()})(window,function(){return c={},w.m=a=[function(u,r,k){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.assignDeep=r.mapValues=void 0,r.mapValues=function(g,b){var d,p,o={};for(d in g)g.hasOwnProperty(d)&&(p=g[d],o[d]=b(p));return o},r.assignDeep=function g(b){for(var d=[],p=1;p<arguments.length;p++)d[p-1]=arguments[p];return d.forEach(function(o){if(o)for(var e in o){var t;o.hasOwnProperty(e)&&(t=o[e],Array.isArray(t)?b[e]=t.slice(0):typeof t=="object"?(b[e]||(b[e]={}),g(b[e],t)):b[e]=t)}}),b}},function(u,r,o){"use strict";var g=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(r,"__esModule",{value:!0});var b=o(7),d=g(o(8)),p=o(0),o=(e.use=function(t){this._pipeline=t},e.from=function(t){return new d.default(t)},Object.defineProperty(e.prototype,"result",{get:function(){return this._result},enumerable:!1,configurable:!0}),e.prototype._process=function(t,i){return this.opts.quantizer,t.scaleDown(this.opts),i=b.buildProcessOptions(this.opts,i),e._pipeline.process(t.getImageData(),i)},e.prototype.palette=function(){return this.swatches()},e.prototype.swatches=function(){throw new Error("Method deprecated. Use `Vibrant.result.palettes[name]` instead")},e.prototype.getPalette=function(){var t=this,i=arguments[0],n=typeof i=="string"?i:"default",s=typeof i=="string"?arguments[1]:i,l=new this.opts.ImageClass;return l.load(this._src).then(function(f){return t._process(f,{generators:[n]})}).then(function(f){return(t._result=f).palettes[n]}).then(function(f){return l.remove(),s&&s(void 0,f),f}).catch(function(f){return l.remove(),s&&s(f),Promise.reject(f)})},e.prototype.getPalettes=function(){var t=this,i=arguments[0],n=arguments[1],s=Array.isArray(i)?i:["*"],l=Array.isArray(i)?n:i,f=new this.opts.ImageClass;return f.load(this._src).then(function(m){return t._process(m,{generators:s})}).then(function(m){return(t._result=m).palettes}).then(function(m){return f.remove(),l&&l(void 0,m),m}).catch(function(m){return f.remove(),l&&l(m),Promise.reject(m)})},e.DefaultOpts={colorCount:64,quality:5,filters:[]},e);function e(t,i){this._src=t,this.opts=p.assignDeep({},e.DefaultOpts,i)}r.default=o},function(u,r,k){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.applyFilters=r.ImageBase=void 0;var g=(b.prototype.scaleDown=function(d){var p,o=this.getWidth(),e=this.getHeight(),t=1;0<d.maxDimension?(p=Math.max(o,e))>d.maxDimension&&(t=d.maxDimension/p):t=1/d.quality,t<1&&this.resize(o*t,e*t,t)},b);function b(){}r.ImageBase=g,r.applyFilters=function(d,p){if(0<p.length)for(var o,e,t,i,n,s=d.data,l=s.length/4,f=0;f<l;f++){e=s[0+(o=4*f)],t=s[1+o],i=s[2+o],n=s[3+o];for(var m=0;m<p.length;m++)if(!p[m](e,t,i,n)){s[3+o]=0;break}}return d}},function(u,r,b){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Swatch=void 0;var g=b(4),b=(d.applyFilters=function(p,o){return 0<o.length?p.filter(function(e){for(var t=e.r,i=e.g,n=e.b,s=0;s<o.length;s++)if(!o[s](t,i,n,255))return!1;return!0}):p},d.clone=function(p){return new d(p._rgb,p._population)},Object.defineProperty(d.prototype,"r",{get:function(){return this._rgb[0]},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"g",{get:function(){return this._rgb[1]},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"b",{get:function(){return this._rgb[2]},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"rgb",{get:function(){return this._rgb},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"hsl",{get:function(){var p,o,e;return this._hsl||(p=(e=this._rgb)[0],o=e[1],e=e[2],this._hsl=g.rgbToHsl(p,o,e)),this._hsl},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"hex",{get:function(){var p,o,e;return this._hex||(p=(e=this._rgb)[0],o=e[1],e=e[2],this._hex=g.rgbToHex(p,o,e)),this._hex},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"population",{get:function(){return this._population},enumerable:!1,configurable:!0}),d.prototype.toJSON=function(){return{rgb:this.rgb,population:this.population}},d.prototype.getRgb=function(){return this._rgb},d.prototype.getHsl=function(){return this.hsl},d.prototype.getPopulation=function(){return this._population},d.prototype.getHex=function(){return this.hex},d.prototype.getYiq=function(){var p;return this._yiq||(p=this._rgb,this._yiq=(299*p[0]+587*p[1]+114*p[2])/1e3),this._yiq},Object.defineProperty(d.prototype,"titleTextColor",{get:function(){return!this._titleTextColor&&(this._titleTextColor=this.getYiq()<200?"#fff":"#000"),this._titleTextColor},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"bodyTextColor",{get:function(){return!this._bodyTextColor&&(this._bodyTextColor=this.getYiq()<150?"#fff":"#000"),this._bodyTextColor},enumerable:!1,configurable:!0}),d.prototype.getTitleTextColor=function(){return this.titleTextColor},d.prototype.getBodyTextColor=function(){return this.bodyTextColor},d);function d(p,o){this._rgb=p,this._population=o}r.Swatch=b},function(u,r,k){"use strict";function g(t){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!i)throw new RangeError("'"+t+"' is not a valid hex color");return[i[1],i[2],i[3]].map(function(n){return parseInt(n,16)})}function b(t,i,n){return i/=255,n/=255,t=.04045<(t/=255)?Math.pow((t+.005)/1.055,2.4):t/12.92,i=.04045<i?Math.pow((i+.005)/1.055,2.4):i/12.92,n=.04045<n?Math.pow((n+.005)/1.055,2.4):n/12.92,[.4124*(t*=100)+.3576*(i*=100)+.1805*(n*=100),.2126*t+.7152*i+.0722*n,.0193*t+.1192*i+.9505*n]}function d(t,i,n){return i/=100,n/=108.883,t=.008856<(t/=95.047)?Math.pow(t,1/3):7.787*t+16/116,[116*(i=.008856<i?Math.pow(i,1/3):7.787*i+16/116)-16,500*(t-i),200*(i-(n=.008856<n?Math.pow(n,1/3):7.787*n+16/116))]}function p(t,i,n){return n=b(t,i,n),d(n[0],n[1],n[2])}function o(m,h){var y=m[0],n=m[1],_=m[2],s=h[0],l=h[1],v=h[2],f=y-s,m=n-l,h=_-v,_=Math.sqrt(n*n+_*_),y=s-y,v=Math.sqrt(l*l+v*v)-_,h=Math.sqrt(f*f+m*m+h*h),h=Math.sqrt(h)>Math.sqrt(Math.abs(y))+Math.sqrt(Math.abs(v))?Math.sqrt(h*h-y*y-v*v):0;return y/=1,v/=1+.045*_,h/=1+.015*_,Math.sqrt(y*y+v*v+h*h)}function e(t,i){return o(p.apply(void 0,t),p.apply(void 0,i))}Object.defineProperty(r,"__esModule",{value:!0}),r.getColorDiffStatus=r.hexDiff=r.rgbDiff=r.deltaE94=r.rgbToCIELab=r.xyzToCIELab=r.rgbToXyz=r.hslToRgb=r.rgbToHsl=r.rgbToHex=r.hexToRgb=r.DELTAE94_DIFF_STATUS=void 0,r.DELTAE94_DIFF_STATUS={NA:0,PERFECT:1,CLOSE:2,GOOD:10,SIMILAR:50},r.hexToRgb=g,r.rgbToHex=function(t,i,n){return"#"+((1<<24)+(t<<16)+(i<<8)+n).toString(16).slice(1,7)},r.rgbToHsl=function(t,i,n){t/=255,i/=255,n/=255;var s=Math.max(t,i,n),l=Math.min(t,i,n),f=0,m=0,_=(s+l)/2;if(s!==l){var y=s-l,m=.5<_?y/(2-s-l):y/(s+l);switch(s){case t:f=(i-n)/y+(i<n?6:0);break;case i:f=(n-t)/y+2;break;case n:f=(t-i)/y+4}f/=6}return[f,m,_]},r.hslToRgb=function(t,i,n){var s,l,f;function m(_,y,v){return v<0&&(v+=1),1<v&&--v,v<1/6?_+6*(y-_)*v:v<.5?y:v<2/3?_+(y-_)*(2/3-v)*6:_}return i===0?s=l=f=n:(s=m(i=2*n-(n=n<.5?n*(1+i):n+i-n*i),n,t+1/3),l=m(i,n,t),f=m(i,n,t-1/3)),[255*s,255*l,255*f]},r.rgbToXyz=b,r.xyzToCIELab=d,r.rgbToCIELab=p,r.deltaE94=o,r.rgbDiff=e,r.hexDiff=function(t,i){return e(g(t),g(i))},r.getColorDiffStatus=function(t){return t<r.DELTAE94_DIFF_STATUS.NA?"N/A":t<=r.DELTAE94_DIFF_STATUS.PERFECT?"Perfect":t<=r.DELTAE94_DIFF_STATUS.CLOSE?"Close":t<=r.DELTAE94_DIFF_STATUS.GOOD?"Good":t<r.DELTAE94_DIFF_STATUS.SIMILAR?"Similar":"Wrong"}},function(u,r,d){"use strict";var g=this&&this.__importDefault||function(p){return p&&p.__esModule?p:{default:p}},b=g(d(6)),d=g(d(9));b.default.DefaultOpts.ImageClass=d.default,u.exports=b.default},function(u,r,k){"use strict";var g=this&&this.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(r,"__esModule",{value:!0}),k=g(k(1)),k.default.DefaultOpts.quantizer="mmcq",k.default.DefaultOpts.generators=["default"],k.default.DefaultOpts.filters=["default"],r.default=k.default},function(u,r,k){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.buildProcessOptions=void 0;var g=k(0);r.buildProcessOptions=function(e,d){var t=e.colorCount,p=e.quantizer,o=e.generators,e=e.filters,t={colorCount:t};return(p=typeof p=="string"?{name:p,options:{}}:p).options=g.assignDeep({},t,p.options),g.assignDeep({},{quantizer:p,generators:o,filters:e},d)}},function(u,r,p){"use strict";var g=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var b=g(p(1)),d=p(0),p=(o.prototype.maxColorCount=function(e){return this._opts.colorCount=e,this},o.prototype.maxDimension=function(e){return this._opts.maxDimension=e,this},o.prototype.addFilter=function(e){return this._opts.filters?this._opts.filters.push(e):this._opts.filters=[e],this},o.prototype.removeFilter=function(e){return!this._opts.filters||0<(e=this._opts.filters.indexOf(e))&&this._opts.filters.splice(e),this},o.prototype.clearFilters=function(){return this._opts.filters=[],this},o.prototype.quality=function(e){return this._opts.quality=e,this},o.prototype.useImageClass=function(e){return this._opts.ImageClass=e,this},o.prototype.useGenerator=function(e,t){return this._opts.generators||(this._opts.generators=[]),this._opts.generators.push(t?{name:e,options:t}:e),this},o.prototype.useQuantizer=function(e,t){return this._opts.quantizer=t?{name:e,options:t}:e,this},o.prototype.build=function(){return new b.default(this._src,this._opts)},o.prototype.getPalette=function(e){return this.build().getPalette(e)},o.prototype.getSwatches=function(e){return this.build().getPalette(e)},o);function o(e,t){t===void 0&&(t={}),this._src=e,this._opts=d.assignDeep({},b.default.DefaultOpts,t)}r.default=p},function(u,r,k){"use strict";var g,d=this&&this.__extends||(g=function(o,e){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})(o,e)},function(o,e){function t(){this.constructor=o}g(o,e),o.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)});Object.defineProperty(r,"__esModule",{value:!0}),k=k(2);var b,d=(b=k.ImageBase,d(p,b),p.prototype._initCanvas=function(){var o=this.image,e=this._canvas=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new ReferenceError("Failed to create canvas context");this._context=t,e.className="@vibrant/canvas",e.style.display="none",this._width=e.width=o.width,this._height=e.height=o.height,t.drawImage(o,0,0),document.body.appendChild(e)},p.prototype.load=function(o){var e,t,i,n,s=this;if(typeof o=="string")e=document.createElement("img"),n=t=o,(n=new URL(n,location.href)).protocol===location.protocol&&n.host===location.host&&n.port===location.port||(i=window.location.href,n=t,i=new URL(i),n=new URL(n),i.protocol===n.protocol&&i.hostname===n.hostname&&i.port===n.port)||(e.crossOrigin="anonymous"),e.src=t;else{if(!(o instanceof HTMLImageElement))return Promise.reject(new Error("Cannot load buffer as an image in browser"));t=(e=o).src}return this.image=e,new Promise(function(l,f){function m(){s._initCanvas(),l(s)}e.complete?m():(e.onload=m,e.onerror=function(_){return f(new Error("Fail to load image: "+t))})})},p.prototype.clear=function(){this._context.clearRect(0,0,this._width,this._height)},p.prototype.update=function(o){this._context.putImageData(o,0,0)},p.prototype.getWidth=function(){return this._width},p.prototype.getHeight=function(){return this._height},p.prototype.resize=function(o,e,t){var i=this._canvas,n=this._context,s=this.image;this._width=i.width=o,this._height=i.height=e,n.scale(t,t),n.drawImage(s,0,0)},p.prototype.getPixelCount=function(){return this._width*this._height},p.prototype.getImageData=function(){return this._context.getImageData(0,0,this._width,this._height)},p.prototype.remove=function(){this._canvas&&this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas)},p);function p(){return b!==null&&b.apply(this,arguments)||this}r.default=d},function(u,r,d){"use strict";var g=this&&this.__importDefault||function(p){return p&&p.__esModule?p:{default:p}},b=d(5),d=g(d(11));b.use(d.default),u.exports=b},function(u,r,k){"use strict";var b=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(r,"__esModule",{value:!0});var g=b(k(12)),b=b(k(16)),b=new(k(17)).BasicPipeline().filter.register("default",function(d,p,o,e){return 125<=e&&!(250<d&&250<p&&250<o)}).quantizer.register("mmcq",g.default).generator.register("default",b.default);r.default=b},function(u,r,k){"use strict";var g=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var b=k(3),d=g(k(13)),p=g(k(15));function o(e,t){for(var i=e.size();e.size()<t;){var n=e.pop();if(!(n&&0<n.count()))break;var s=n.split(),n=s[0],s=s[1];if(e.push(n),s&&0<s.count()&&e.push(s),e.size()===i)break;i=e.size()}}r.default=function(n,t){if(n.length===0||t.colorCount<2||256<t.colorCount)throw new Error("Wrong MMCQ parameters");var i=d.default.build(n),n=(i.histogram.colorCount,new p.default(function(s,l){return s.count()-l.count()}));return n.push(i),o(n,.75*t.colorCount),i=new p.default(function(s,l){return s.count()*s.volume()-l.count()*l.volume()}),i.contents=n.contents,o(i,t.colorCount-i.size()),function(s){for(var l=[];s.size();){var f=s.pop(),m=f.avg();m[0],m[1],m[2],l.push(new b.Swatch(m,f.count()))}return l}(i)}},function(u,r,d){"use strict";var g=this&&this.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(r,"__esModule",{value:!0});var b=g(d(14)),d=(p.build=function(o){return o=new b.default(o,{sigBits:5}),new p(o.rmin,o.rmax,o.gmin,o.gmax,o.bmin,o.bmax,o)},p.prototype.invalidate=function(){this._volume=this._count=-1,this._avg=null},p.prototype.volume=function(){var o,e,t,i,n,s;return this._volume<0&&(o=(s=this.dimension).r1,e=s.r2,t=s.g1,i=s.g2,n=s.b1,s=s.b2,this._volume=(e-o+1)*(i-t+1)*(s-n+1)),this._volume},p.prototype.count=function(){if(this._count<0){for(var i=this.histogram,o=i.hist,e=i.getColorIndex,t=this.dimension,i=t.r1,n=t.r2,s=t.g1,l=t.g2,f=t.b1,m=t.b2,_=0,y=i;y<=n;y++)for(var v=s;v<=l;v++)for(var h=f;h<=m;h++)_+=o[e(y,v,h)];this._count=_}return this._count},p.prototype.clone=function(){var o=this.histogram,e=this.dimension;return new p(e.r1,e.r2,e.g1,e.g2,e.b1,e.b2,o)},p.prototype.avg=function(){if(!this._avg){for(var i=this.histogram,o=i.hist,e=i.getColorIndex,t=this.dimension,i=t.r1,n=t.r2,s=t.g1,l=t.g2,f=t.b1,m=t.b2,_=0,h=void 0,y=void 0,v=void 0,h=y=v=0,S=i;S<=n;S++)for(var C=s;C<=l;C++)for(var M=f;M<=m;M++){var D=o[e(S,C,M)];_+=D,h+=D*(S+.5)*8,y+=D*(C+.5)*8,v+=D*(M+.5)*8}this._avg=_?[~~(h/_),~~(y/_),~~(v/_)]:[~~(8*(i+n+1)/2),~~(8*(s+l+1)/2),~~(8*(f+m+1)/2)]}return this._avg},p.prototype.contains=function(m){var e=m[0],t=m[1],i=m[2],_=this.dimension,n=_.r1,s=_.r2,l=_.g1,f=_.g2,m=_.b1,_=_.b2;return t>>=3,i>>=3,n<=(e>>=3)&&e<=s&&l<=t&&t<=f&&m<=i&&i<=_},p.prototype.split=function(){var y=this.histogram,o=y.hist,e=y.getColorIndex,C=this.dimension,t=C.r1,i=C.r2,n=C.g1,s=C.g2,l=C.b1,f=C.b2,v=this.count();if(!v)return[];if(v===1)return[this.clone()];var m,_=i-t+1,y=s-n+1,C=f-l+1,v=Math.max(_,y,C),h=null,S=m=0,C=null;if(v===_){C="r",h=new Uint32Array(i+1);for(var M=t;M<=i;M++){S=0;for(var D=n;D<=s;D++)for(var T=l;T<=f;T++)S+=o[e(M,D,T)];m+=S,h[M]=m}}else if(v===y)for(C="g",h=new Uint32Array(s+1),D=n;D<=s;D++){for(S=0,M=t;M<=i;M++)for(T=l;T<=f;T++)S+=o[e(M,D,T)];m+=S,h[D]=m}else for(C="b",h=new Uint32Array(f+1),T=l;T<=f;T++){for(S=0,M=t;M<=i;M++)for(D=n;D<=s;D++)S+=o[e(M,D,T)];m+=S,h[T]=m}for(var N=-1,$=new Uint32Array(h.length),E=0;E<h.length;E++){var J=h[E];N<0&&m/2<J&&(N=E),$[E]=m-J}var q=this;return function(I){for(var Z=I+"1",B=I+"2",Q=q.dimension[Z],L=q.dimension[B],X=q.clone(),K=q.clone(),tt=N-Q,L=tt<=(I=L-N)?(L=Math.min(L-1,~~(N+I/2)),Math.max(0,L)):(L=Math.max(Q,~~(N-1-tt/2)),Math.min(q.dimension[B],L));!h[L];)L++;for(var et=$[L];!et&&h[L-1];)et=$[--L];return X.dimension[B]=L,K.dimension[Z]=L+1,[X,K]}(C)},p);function p(o,e,t,i,n,s,l){this.histogram=l,this._volume=-1,this._count=-1,this.dimension={r1:o,r2:e,g1:t,g2:i,b1:n,b2:s}}r.default=d},function(u,r,k){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var g=(Object.defineProperty(b.prototype,"colorCount",{get:function(){return this._colorCount},enumerable:!1,configurable:!0}),b);function b(d,p){this.pixels=d;function o(D,T,N){return(D<<2*e)+(T<<e)+N}var e=(this.opts=p).sigBits;this.getColorIndex=o;for(var t,i,n,s,l,f,m,_=8-e,y=new Uint32Array(1<<3*e),v=t=n=0,h=i=s=Number.MAX_VALUE,S=d.length/4,C=0;C<S;){var M=4*C;C++,l=d[0+M],f=d[1+M],m=d[2+M],d[3+M]!==0&&(y[o(l>>=_,f>>=_,m>>=_)]+=1,v<l&&(v=l),l<h&&(h=l),t<f&&(t=f),f<i&&(i=f),n<m&&(n=m),m<s&&(s=m))}this._colorCount=y.reduce(function(D,T){return 0<T?D+1:D},0),this.hist=y,this.rmax=v,this.rmin=h,this.gmax=t,this.gmin=i,this.bmax=n,this.bmin=s}r.default=g},function(u,r,k){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var g=(b.prototype._sort=function(){this._sorted||(this.contents.sort(this._comparator),this._sorted=!0)},b.prototype.push=function(d){this.contents.push(d),this._sorted=!1},b.prototype.peek=function(d){return this._sort(),d=typeof d=="number"?d:this.contents.length-1,this.contents[d]},b.prototype.pop=function(){return this._sort(),this.contents.pop()},b.prototype.size=function(){return this.contents.length},b.prototype.map=function(d){return this._sort(),this.contents.map(d)},b);function b(d){this._comparator=d,this.contents=[],this._sorted=!1}r.default=g},function(u,r,k){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var g=k(3),b=k(4),d={targetDarkLuma:.26,maxDarkLuma:.45,minLightLuma:.55,targetLightLuma:.74,minNormalLuma:.3,targetNormalLuma:.5,maxNormalLuma:.7,targetMutesSaturation:.3,maxMutesSaturation:.4,targetVibrantSaturation:1,minVibrantSaturation:.35,weightSaturation:3,weightLuma:6.5,weightPopulation:.5};function p(e,t,i,n,s,l,f){function m(_,y){return 1-Math.abs(_-y)}return function(){for(var _=[],y=0;y<arguments.length;y++)_[y]=arguments[y];for(var v=0,h=0,S=0;S<_.length;S+=2){var C=_[S],M=_[S+1];v+=C*M,h+=M}return v/h}(m(e,t),f.weightSaturation,m(i,n),f.weightLuma,s/l,f.weightPopulation)}function o(e,t,i,n,s,l,f,m,_,y){var v=null,h=0;return t.forEach(function(S){var C,M=S.hsl,D=M[1],T=M[2];m<=D&&D<=_&&s<=T&&T<=l&&(C=S,(M=e).Vibrant!==C&&M.DarkVibrant!==C&&M.LightVibrant!==C&&M.Muted!==C&&M.DarkMuted!==C&&M.LightMuted!==C)&&(T=p(D,f,T,n,S.population,i,y),(v===null||h<T)&&(v=S,h=T))}),v}r.default=function(e,t){t=Object.assign({},d,t);var i,n,s,l,f,m,_,y,v,h,S=(i=0,e.forEach(function(C){i=Math.max(i,C.population)}),i),S=((s={Vibrant:null,DarkVibrant:null,LightVibrant:null,Muted:null,DarkMuted:null,LightMuted:null}).Vibrant=o(s,n=e,e=S,(S=t).targetNormalLuma,S.minNormalLuma,S.maxNormalLuma,S.targetVibrantSaturation,S.minVibrantSaturation,1,S),s.LightVibrant=o(s,n,e,S.targetLightLuma,S.minLightLuma,1,S.targetVibrantSaturation,S.minVibrantSaturation,1,S),s.DarkVibrant=o(s,n,e,S.targetDarkLuma,0,S.maxDarkLuma,S.targetVibrantSaturation,S.minVibrantSaturation,1,S),s.Muted=o(s,n,e,S.targetNormalLuma,S.minNormalLuma,S.maxNormalLuma,S.targetMutesSaturation,0,S.maxMutesSaturation,S),s.LightMuted=o(s,n,e,S.targetLightLuma,S.minLightLuma,1,S.targetMutesSaturation,0,S.maxMutesSaturation,S),s.DarkMuted=o(s,n,e,S.targetDarkLuma,0,S.maxDarkLuma,S.targetMutesSaturation,0,S.maxMutesSaturation,S),s);return s=t,(t=S).Vibrant||t.DarkVibrant||t.LightVibrant||(!t.DarkVibrant&&t.DarkMuted&&(y=(h=t.DarkMuted.hsl)[0],v=h[1],h=h[2],h=s.targetDarkLuma,t.DarkVibrant=new g.Swatch(b.hslToRgb(y,v,h),0)),!t.LightVibrant&&t.LightMuted&&(y=(l=t.LightMuted.hsl)[0],v=l[1],h=l[2],h=s.targetDarkLuma,t.DarkVibrant=new g.Swatch(b.hslToRgb(y,v,h),0))),!t.Vibrant&&t.DarkVibrant?(y=(l=t.DarkVibrant.hsl)[0],v=l[1],h=l[2],h=s.targetNormalLuma,t.Vibrant=new g.Swatch(b.hslToRgb(y,v,h),0)):!t.Vibrant&&t.LightVibrant&&(y=(f=t.LightVibrant.hsl)[0],v=f[1],h=f[2],h=s.targetNormalLuma,t.Vibrant=new g.Swatch(b.hslToRgb(y,v,h),0)),!t.DarkVibrant&&t.Vibrant&&(y=(f=t.Vibrant.hsl)[0],v=f[1],h=f[2],h=s.targetDarkLuma,t.DarkVibrant=new g.Swatch(b.hslToRgb(y,v,h),0)),!t.LightVibrant&&t.Vibrant&&(y=(m=t.Vibrant.hsl)[0],v=m[1],h=m[2],h=s.targetLightLuma,t.LightVibrant=new g.Swatch(b.hslToRgb(y,v,h),0)),!t.Muted&&t.Vibrant&&(y=(m=t.Vibrant.hsl)[0],v=m[1],h=m[2],h=s.targetMutesSaturation,t.Muted=new g.Swatch(b.hslToRgb(y,v,h),0)),!t.DarkMuted&&t.DarkVibrant&&(y=(_=t.DarkVibrant.hsl)[0],v=_[1],h=_[2],h=s.targetMutesSaturation,t.DarkMuted=new g.Swatch(b.hslToRgb(y,v,h),0)),!t.LightMuted&&t.LightVibrant&&(y=(_=t.LightVibrant.hsl)[0],v=_[1],h=_[2],h=s.targetMutesSaturation,t.LightMuted=new g.Swatch(b.hslToRgb(y,v,h),0)),S}},function(u,r,k){"use strict";var g=this&&this.__awaiter||function(t,i,n,s){return new(n=n||Promise)(function(l,f){function m(v){try{y(s.next(v))}catch(h){f(h)}}function _(v){try{y(s.throw(v))}catch(h){f(h)}}function y(v){var h;v.done?l(v.value):((h=v.value)instanceof n?h:new n(function(S){S(h)})).then(m,_)}y((s=s.apply(t,i||[])).next())})},b=this&&this.__generator||function(t,i){var n,s,l,f={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]},m={next:_(0),throw:_(1),return:_(2)};return typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function _(y){return function(v){return function(h){if(n)throw new TypeError("Generator is already executing.");for(;f;)try{if(n=1,s&&(l=2&h[0]?s.return:h[0]?s.throw||((l=s.return)&&l.call(s),0):s.next)&&!(l=l.call(s,h[1])).done)return l;switch(s=0,l&&(h=[2&h[0],l.value]),h[0]){case 0:case 1:l=h;break;case 4:return f.label++,{value:h[1],done:!1};case 5:f.label++,s=h[1],h=[0];continue;case 7:h=f.ops.pop(),f.trys.pop();continue;default:if(!(l=0<(l=f.trys).length&&l[l.length-1])&&(h[0]===6||h[0]===2)){f=0;continue}if(h[0]===3&&(!l||h[1]>l[0]&&h[1]<l[3])){f.label=h[1];break}if(h[0]===6&&f.label<l[1]){f.label=l[1],l=h;break}if(l&&f.label<l[2]){f.label=l[2],f.ops.push(h);break}l[2]&&f.ops.pop(),f.trys.pop();continue}h=i.call(t,f)}catch(S){h=[6,S],s=0}finally{n=l=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([y,v])}}};Object.defineProperty(r,"__esModule",{value:!0}),r.BasicPipeline=r.Stage=void 0;var d=k(2),p=(o.prototype.names=function(){return Object.keys(this._map)},o.prototype.has=function(t){return!!this._map[t]},o.prototype.get=function(t){return this._map[t]},o.prototype.register=function(t,i){return this._map[t]=i,this.pipeline},o);function o(t){this.pipeline=t,this._map={}}r.Stage=p,e.prototype._buildProcessTasks=function(l){var i=this,n=l.filters,s=l.quantizer,l=l.generators;return l.length===1&&l[0]==="*"&&(l=this.generator.names()),{filters:n.map(function(m){return f(i.filter,m)}),quantizer:f(this.quantizer,s),generators:l.map(function(m){return f(i.generator,m)})};function f(m,_){var y,v;return typeof _=="string"?y=_:(y=_.name,v=_.options),{name:y,fn:m.get(y),options:v}}},e.prototype.process=function(t,i){return g(this,void 0,void 0,function(){var n,s,l,f;return b(this,function(m){switch(m.label){case 0:return f=this._buildProcessTasks(i),s=f.filters,n=f.quantizer,f=f.generators,[4,this._filterColors(s,t)];case 1:return s=m.sent(),[4,this._generateColors(n,s)];case 2:return l=m.sent(),[4,this._generatePalettes(f,l)];case 3:return f=m.sent(),[2,{colors:l,palettes:f}]}})})},e.prototype._filterColors=function(t,i){return Promise.resolve(d.applyFilters(i,t.map(function(n){return n.fn})))},e.prototype._generateColors=function(t,i){return Promise.resolve(t.fn(i.data,t.options))},e.prototype._generatePalettes=function(t,i){return g(this,void 0,void 0,function(){var n;return b(this,function(s){switch(s.label){case 0:return[4,Promise.all(t.map(function(m){var f=m.fn,m=m.options;return Promise.resolve(f(i,m))}))];case 1:return n=s.sent(),[2,Promise.resolve(n.reduce(function(l,f,m){return l[t[m].name]=f,l},{}))]}})})},k=e;function e(){this.filter=new p(this),this.quantizer=new p(this),this.generator=new p(this)}r.BasicPipeline=k}],w.c=c,w.d=function(u,r,k){w.o(u,r)||Object.defineProperty(u,r,{enumerable:!0,get:k})},w.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},w.t=function(u,r){if(1&r&&(u=w(u)),8&r||4&r&&typeof u=="object"&&u&&u.__esModule)return u;var k=Object.create(null);if(w.r(k),Object.defineProperty(k,"default",{enumerable:!0,value:u}),2&r&&typeof u!="string")for(var g in u)w.d(k,g,function(b){return u[b]}.bind(null,g));return k},w.n=function(u){var r=u&&u.__esModule?function(){return u.default}:function(){return u};return w.d(r,"a",r),r},w.o=function(u,r){return Object.prototype.hasOwnProperty.call(u,r)},w.p="",w(w.s=10);function w(u){if(c[u])return c[u].exports;var r=c[u]={i:u,l:!1,exports:{}};return a[u].call(r.exports,r,r.exports,w),r.l=!0,r.exports}var a,c})});var ft=A(V=>{var Tt=new Intl.PluralRules("en",{type:"ordinal"}),Lt={one:"st",two:"nd",few:"rd",other:"th"},Pt="January February March April May June July August September October November December".split(" ");V.formatOrdinal=w=>{let a=Tt.select(w),c=Lt[a];return`${w}${c}`};V.getMonth=w=>Pt[w];V.formatDuration=w=>`${Math.floor(w/6e4)}:${Math.floor(w/1e3%60).toString().padStart(2,"0")}`;V.toClassName=(w,a)=>w.concat(...Object.keys(a).filter(c=>a[c])).join(" ")});var vt=A((ae,bt)=>{var{get:At}=require("powercord/http"),{React:x,getModule:Nt}=require("powercord/webpack"),{Spinner:Ot}=require("powercord/components"),Et=ht(),qt=pt(),{formatOrdinal:Vt,getMonth:dt,formatDuration:mt,toClassName:It}=ft(),{REPO_ISSUES_URL:jt,SwatchOption:gt}=j(),Y={...Nt(["thin"],!1)};bt.exports=Et(class extends x.PureComponent{state={artData:null,fetchingArt:!1,accentSwatches:null,resourceData:null,fetchingResource:!1,selectedTrack:0};get _fetchedArt(){return this.state.artData}get _hasArtData(){return this.state.artData&&this.state.artData!=="DEFAULT"}async getSwatches(){let{getSetting:a}=this.props;if(this.state.accentSwatches||!this._hasArtData||a("swatch",gt.DarkVibrant)==="None")return;let c=await qt.from(this.state.artData).getSwatches();this.setState({accentSwatches:c})}async fetchArt(a){if(!(this._fetchedArt||this.state.fetchingArt))return this.setState({fetchingArt:!0}),At(a).then(c=>{if(c.ok)return`data:${c.headers["content-type"]};base64,${c.raw.base64Slice()}`;throw null}).catch(c=>(c&&console.log(c),"DEFAULT")).then(c=>{this.setState({artData:c,fetchingArt:!1})})}fetchResourceData(a,c){if(this.state.resourceData!=null||this.state.fetchingResource)return;let{spotifyApi:u}=this.props,r=k=>this.setState({fetchingResource:!1,resourceData:k});switch(this.setState({fetchingResource:!0}),a){case"track":return u.getTrack(c).then(r);case"album":return u.getAlbum(c).then(r);case"playlist":return u.getPlaylist(c).then(r);case"artist":return u.getArtist(c).then(k=>u.getArtistTopTracks(c,"US").then(g=>r({...k,top_tracks:g.tracks})))}}getEmbedStyle(){let{getSetting:a}=this.props,c="var(--background-secondary)",u="var(--text-normal)",r="var(--text-normal)",k=a("swatch",gt.DarkVibrant);if(this.state.accentSwatches&&k!=="None"){let g=this.state.accentSwatches[k];c=g.hex,u=g.getTitleTextColor(),r=g.getBodyTextColor()}return{background:c,"--vpc-spotimbed-title":u,color:r}}formatReleaseDate(a){let c=a.split("-");return c[1]?c[2]?`${dt(c[1]-1)} ${Vt(+c[2])}, ${c[0]}`:`${dt(c[1]-1)} ${c[0]}`:c[0]}renderArt(){return this._hasArtData?x.createElement("img",{draggable:"false",className:"vpc-spotimbed-art",src:this.state.artData}):this.state.fetchingArt?x.createElement("div",{className:"vpc-spotimbed-art vpc-spotimbed-art-loading"},x.createElement(Ot,{type:"spinningCircle"})):x.createElement("svg",{className:"vpc-spotimbed-art vpc-spotimbed-art-default",width:"52",height:"52",viewBox:"0 0 52 52",xmlns:"http://www.w3.org/2000/svg"},x.createElement("title",null,"Album"),x.createElement("path",{d:"M26 0.00100708C11.641 0.00100708 0 11.642 0 26.001C0 40.36 11.641 52.001 26 52.001C40.36 52 52 40.36 52 26C52 11.64 40.36 0.00100708 26 0.00100708ZM26 50C12.767 50 2 39.234 2 26C2 12.766 12.767 2.00001 26 2.00001C39.234 2.00001 50 12.766 50 26C50 39.234 39.234 50 26 50ZM26 18C21.582 18 18 21.582 18 26C18 30.418 21.582 34 26 34C30.418 34 34 30.418 34 26C34 21.582 30.419 18 26 18ZM26 32C22.692 32 20 29.309 20 26C20 22.691 22.692 20 26 20C29.308 20 32 22.691 32 26C32 29.309 29.309 32 26 32Z",fill:"currentColor","fill-rule":"evenodd"}))}renderPlaceholderInfo(){return x.createElement("div",{className:"vpc-spotimbed-info"},x.createElement("div",null,x.createElement("span",{className:"vpc-spotimbed-placeholder"},"movies for guys")),x.createElement("div",null,x.createElement("span",{className:"vpc-spotimbed-placeholder"},"by dltzk")),x.createElement("div",null,x.createElement("span",{className:"vpc-spotimbed-placeholder"},"on Frailty")))}renderResourceLink(a,c=""){let u=a.name,r=a.external_urls?.spotify;return a.type==="user"&&(u=a.display_name),x.createElement("a",{className:["vpc-spotimbed-link"].concat(c.split(" ")).join(" "),href:r,"data-resource-link":!0,target:"_blank",title:u},u)}renderByline(a){let c=a.length===1?this.renderResourceLink(a[0]):this.renderArtists(a);return x.createElement("div",{className:"vpc-spotimbed-infoline"},x.createElement("span",null,"by "),c)}renderArtists(a){let c=a.map(r=>r.name).join(", "),u=a.map(r=>x.createElement("a",{className:"vpc-spotimbed-link vpc-spotimbed-infoline",href:r.external_urls.spotify,target:"_blank"},r.name)).reduce((r,k)=>[r,", ",k]);return x.createElement("span",{title:c},u)}renderTrackRowInfo(a){return x.createElement("div",{className:"vpc-spotimbed-trackrow-info"},this.renderResourceLink(a,"vpc-spotimbed-trackrow-title"),x.createElement("div",{className:"vpc-spotimbed-trackrow-infoline"},this.renderByline(a.artists)))}renderTrackList(a){let c=[];for(let u=0;u<a.length;u++){let r=a[u],k=[];k.push(x.createElement("div",{className:"vpc-spotimbed-trackrow-index vpc-spotimbed-mono"},u+1)),k.push(this.renderTrackRowInfo(r)),k.push(x.createElement("div",{className:"vpc-spotimbed-trackrow-length vpc-spotimbed-mono"},mt(r.duration_ms))),c.push(x.createElement("div",{className:It(["vpc-spotimbed-trackrow"],{"vpc-spotimbed-active":u===this.state.selectedTrack}),onClick:()=>{u!==this.state.selectedTrack&&this.setState({selectedTrack:u})},ref:u===this.state.selectedTrack&&this.contrastRef("track-row-active")},k))}return c}render(){let{AudioControls:a,art:c,type:u,id:r}=this.props;switch(u){case"track":{this.fetchArt(c).then(()=>this.getSwatches()),this.fetchResourceData(u,r);let k=this.renderArt(),g,{resourceData:b}=this.state;return b?g=x.createElement("div",{className:"vpc-spotimbed-info"},x.createElement("div",{className:"vpc-spotimbed-titleline"},this.renderResourceLink(b,"vpc-spotimbed-title"),x.createElement("span",{className:"vpc-spotimbed-title-tag vpc-spotimbed-mono"},mt(b.duration_ms))),x.createElement("div",{className:"vpc-spotimbed-infoline-wrap"},this.renderByline(b.artists)),x.createElement("div",{className:"vpc-spotimbed-infoline-wrap"},x.createElement("div",{className:"vpc-spotimbed-infoline"},"on ",this.renderResourceLink(b.album,"vpc-spotimbed-track-album")))):g=this.renderPlaceholderInfo(),x.createElement("div",{className:"vpc-spotimbed-embed",style:this.getEmbedStyle()},x.createElement("div",{className:"vpc-spotimbed-art-wrap"},k),g,x.createElement(a,{mediaHref:this.state.resourceData?.preview_url}))}case"album":{this.fetchArt(c).then(()=>this.getSwatches()),this.fetchResourceData(u,r);let k=this.renderArt(),{resourceData:g}=this.state,b,d,p;if(g){let o="Album";g.album_type==="single"?o=g.total_tracks>=4?"EP":"Single":g.album_type==="compilation"&&(o="Compilation");let t=this.formatReleaseDate(g.release_date);g.total_tracks>1&&(t+=` \u2022 ${g.total_tracks} songs`),b=x.createElement("div",{className:"vpc-spotimbed-info"},x.createElement("div",{className:"vpc-spotimbed-titleline"},this.renderResourceLink(g,"vpc-spotimbed-title"),x.createElement("span",{className:"vpc-spotimbed-title-tag"},o)),x.createElement("div",{className:"vpc-spotimbed-infoline-wrap"},this.renderByline(g.artists)),x.createElement("div",{className:"vpc-spotimbed-infoline vpc-spotimbed-infoline-secondary"},t)),d=this.renderTrackList(g.tracks.items),p=g.tracks.items[this.state.selectedTrack].preview_url}else b=this.renderPlaceholderInfo();return x.createElement("div",{className:"vpc-spotimbed-embed",style:this.getEmbedStyle()},x.createElement("div",{className:"vpc-spotimbed-art-wrap"},k),b,x.createElement("div",{className:`vpc-spotimbed-content vpc-spotimbed-tracklist ${Y.thin}`},d),x.createElement(a,{mediaHref:p}))}case"playlist":{this.fetchArt(c).then(()=>this.getSwatches()),this.fetchResourceData(u,r);let k=this.renderArt(),{resourceData:g}=this.state,b,d,p;if(g){let o=`${g.followers.total} likes \u2022 ${g.tracks.total} songs`;b=x.createElement("div",{className:"vpc-spotimbed-info"},x.createElement("div",{className:"vpc-spotimbed-titleline"},this.renderResourceLink(g,"vpc-spotimbed-title")),x.createElement("div",{className:"vpc-spotimbed-infoline-wrap"},this.renderByline([g.owner])),x.createElement("div",{className:"vpc-spotimbed-infoline vpc-spotimbed-infoline-secondary"},o));let e=g.tracks.items.filter(t=>!t.is_local&&t.track).map(t=>t.track);d=this.renderTrackList(e),p=e[this.state.selectedTrack]?.preview_url}else b=this.renderPlaceholderInfo();return x.createElement("div",{className:"vpc-spotimbed-embed",style:this.getEmbedStyle()},x.createElement("div",{className:"vpc-spotimbed-art-wrap"},k),b,x.createElement("div",{className:`vpc-spotimbed-content vpc-spotimbed-tracklist ${Y.thin}`},d),x.createElement(a,{mediaHref:p}))}case"artist":{this.fetchArt(c).then(()=>this.getSwatches()),this.fetchResourceData(u,r);let k=this.renderArt(),{resourceData:g}=this.state,b,d,p;return g?(b=x.createElement("div",{className:"vpc-spotimbed-info"},x.createElement("div",{className:"vpc-spotimbed-titleline"},this.renderResourceLink(g,"vpc-spotimbed-title")),x.createElement("div",{className:"vpc-spotimbed-infoline vpc-spotimbed-infoline-secondary"},"Top Tracks")),d=this.renderTrackList(g.top_tracks),p=g.top_tracks[this.state.selectedTrack].preview_url):b=this.renderPlaceholderInfo(),x.createElement("div",{className:"vpc-spotimbed-embed",style:this.getEmbedStyle()},x.createElement("div",{className:"vpc-spotimbed-art-wrap"},k),b,x.createElement("div",{className:`vpc-spotimbed-content vpc-spotimbed-tracklist ${Y.thin}`},d),x.createElement(a,{mediaHref:p}))}default:return x.createElement("div",{className:"vpc-spotimbed-unsupported"},"This Spotify embed is not supported by SpotImbed, please ",x.createElement("a",{href:jt,target:"_blank"},"open an issue")," and include the above link")}}})});var _t=A((le,yt)=>{var{React:P,getModuleByDisplayName:Ut}=require("powercord/webpack"),{AsyncComponent:Ft}=require("powercord/components"),zt=Ft.from(Ut("MediaPlayer").then(w=>class extends w{render(){return P.cloneElement(super.render(),{className:"vpc-spotimbed-media-player"})}}));yt.exports=class extends P.PureComponent{constructor(a){super(a),this.state={volume:a.getSetting("volume",.5),isMuted:!1}}onMute(a){this.setState({isMuted:a})}onVolumeChange(a){this.props.updateSetting("volume",a),this.setState({volume:a})}render(){let{mediaHref:a}=this.props,c;return a?c=P.createElement(zt,{key:a,src:a,type:"AUDIO",height:300,width:400,forceExternal:!1,autoPlay:!1,playable:!0,fileName:"",fileSize:"",renderLinkComponent:()=>P.createElement(P.Fragment,null),volume:()=>this.state.volume,onMute:this.onMute.bind(this),onVolumeChange:this.onVolumeChange.bind(this),autoMute:()=>{}}):c=P.createElement("div",{className:"vpc-spotimbed-placeholder-wrap"},P.createElement("div",{className:"vpc-spotimbed-placeholder vpc-spotimbed-placeholder-btn"}),P.createElement("div",{className:"vpc-spotimbed-placeholder",style:{width:"66px"}}),P.createElement("div",{className:"vpc-spotimbed-placeholder vpc-spotimbed-placeholder-scrubber"}),P.createElement("div",{className:"vpc-spotimbed-placeholder vpc-spotimbed-placeholder-btn"})),P.createElement("div",{className:"vpc-spotimbed-controls"},c)}}});var{Plugin:$t}=require("powercord/entities"),{React:wt,getModule:he,getModuleByDisplayName:Bt}=require("powercord/webpack"),{inject:Ht,uninject:Rt}=require("powercord/injector"),{getReactInstance:pe}=require("powercord/util"),Gt=st(),Wt=at(),Yt=vt(),Jt=_t(),Zt=Bt("Embed",!1);module.exports=class extends $t{startPlugin(){this.loadStylesheet("style.css"),this.ConnectedAltSpotifyEmbed=this.settings.connectStore(Yt),this.ConnectedAudioControls=this.settings.connectStore(Jt),powercord.api.settings.registerSettings("vpc-spotimbed",{category:this.entityID,label:"SpotiMbed",render:({getSetting:a,updateSetting:c,toggleSetting:u})=>wt.createElement(Wt,{getSetting:a,updateSetting:c,toggleSetting:u})}),this.patchSpotifyEmbed()}pluginWillUnload(){Rt("vpc-spotimbed-embed"),powercord.api.settings.unregisterSettings("vpc-spotimbed")}patchSpotifyEmbed(){Ht("vpc-spotimbed-embed",Zt.prototype,"render",(a,c)=>{let{embed:u}=c.props;if(u?.provider?.name==="Spotify"){let[,r,k]=new URL(u.url).pathname.split("/");return wt.createElement(this.ConnectedAltSpotifyEmbed,{art:u.thumbnail.url,id:k,type:r,spotifyApi:Gt,AudioControls:this.ConnectedAudioControls})}else return c})}};
